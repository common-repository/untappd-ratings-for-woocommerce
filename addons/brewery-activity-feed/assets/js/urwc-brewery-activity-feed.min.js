/*!
 * Untappd Ratings for WooCommerce
 * https://github.com/ChillCode/untappd-ratings-for-woocommerce
 *
 *
 * Copyright (C) 2024 ChillCode
 *
 * @license Released under the General Public License v3.0 https://www.gnu.org/licenses/gpl-3.0.html
 *
 */
!function(e){e.fn.UntappdMap=function(n){const a=[];let t=null;const o=e.extend({mapZoom:"4",mapHeight:"500",mapWidth:"640",mapCentermap:"yes",mapCenterlat:"34.2346598",mapCenterlng:"-77.9482096",mapUseicon:1,mapUseurlicon:"",mapType:"interactive"},e(this).data());function i(){e(".urwc-map-loading-overlay-"+o.mapUniqid).toggle(),e(".urwc-map-loading-content-"+o.mapUniqid).toggle()}function p(n){e(".urwc-map-loading-overlay-"+o.mapUniqid).css({display:"block"}),e(".urwc-map-loading-content-"+o.mapUniqid).css({display:"block",background:"none"}).text("[Untappd Ratings for WooCommerce] "+n)}function r(){i();const n=e.ajax({url:o.mapAjaxurl,dataType:"json",type:"GET",data:{action:"urwc_map_feed",security:o.mapNonce,scid:o.mapScid}});n.done((function(e){e.error?p(e.error):(i(),"static"===o.mapType?function(e){const n=document.getElementById(o.mapId);if(!n)return p("Element is not present in the current DOM, static map could not be initialized."),!1;let a=[];"yes"===o.mapCentermap&&(a=[o.mapCenterlat,o.mapCenterlng]);let t="size:small|color:0x2ad2c5|";o.mapUseurlicon&&(t="icon:"+o.mapUseurlicon+"|");for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n))for(const i in e[n])if(Object.prototype.hasOwnProperty.call(e[n],i)){if(!e[n][i].lat||!e[n][i].lng)return!1;"yes"!==o.mapCentermap&&(a=[e[n][i].lat,e[n][i].lng]),t=t+e[n][i].lat+","+e[n][i].lng+"|";break}const i=new URLSearchParams;i.set("center",a.toString()),o.mapLang&&i.set("language",o.mapLang);i.set("zoom",o.mapZoom),i.set("size",parseInt(o.mapWidth)+"x"+parseInt(o.mapHeight)),i.set("markers",t),i.set("scale",1),i.set("key",o.mapApikey);const r='<img src="https://maps.googleapis.com/maps/api/staticmap?'+i+'">';n.innerHTML=r}(e):"interactive"===o.mapType?async function(e){const{Map:n}=await google.maps.importLibrary("maps"),a=new google.maps.LatLng(o.mapCenterlat,o.mapCenterlng),i={zoom:o.mapZoom,center:a,scrollwheel:!1,scaleControl:!0,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},streetViewControl:!0,mapTypeControl:!0},r=document.getElementById(o.mapId);if(r){t=new n(r,i),"yes"===o.center_map&&t.setCenter(a);for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&c(e[n])}else p("Element is not present in the current DOM, map could not be initialized.")}(e):p("Invalid map type, valid options are static or interactive (default)."))})),n.fail((function(e,n){p(n)}))}function c(i){let p={},r="";const c=[];for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e)){if(!i[e].lat||!i[e].lng)return!1;p={lat:i[e].lat,lng:i[e].lng},r=i[e].venue_name,c.push({data:i[e],html:l(i[e])})}let m;o.mapUseicon?m={path:"m24.145 3.2668c-4.9298 9.8904-5.2263 9.421-5.4302 10.7l-0.32123 2.0263c-0.11747 0.74134-0.40772 1.4518-0.84633 2.0634l-9.1986 12.837c-0.4695 0.65483-1.2602 1.0008-2.0633 0.90194-2.4896-0.30888-4.8062-1.9892-5.8873-4.2317-0.35213-0.72897-0.27799-1.5938 0.1915-2.2487l9.1986-12.843c0.43861-0.61161 1.0131-1.112 1.6803-1.4641l1.8101-0.95752c1.1429-0.60543 0.59925-0.73515 8.3769-8.5808 0.06193-0.29653 0.06193-0.45096 0.22231-0.49422 0.18544-0.043224 0.40774-0.061934 0.38919-0.28415l-0.02534-0.2842c-0.01267-0.11747 0.08029-0.22232 0.19782-0.22232 0.278-0.004737 0.81546 0.074013 1.5815 0.61778 0.75985 0.54981 1.0131 1.0379 1.0934 1.3035 0.03718 0.1112-0.03718 0.22864-0.14829 0.25946l-0.27802 0.067974c-0.20993 0.05554-0.15435 0.27181-0.14198 0.45714 0.0047 0.17306-0.14199 0.22232-0.40154 0.37684zm-10.576-0.83398c0.20994 0.05554 0.15436 0.27181 0.14198 0.45714-0.01267 0.16675 0.1296 0.21626 0.39538 0.37067 0.48804 0.98225 0.94518 1.8842 1.3714 2.7182 0.04322 0.08029 0.14198 0.092724 0.20387 0.03079 0.69189-0.74134 1.5197-1.6186 2.502-2.6317 0.08029-0.086448 0.08645-0.21626 0.0047-0.30271-0.49416-0.50658-1.0193-1.044-1.5814-1.6124-0.061934-0.29036-0.061934-0.45098-0.22231-0.49423-0.18544-0.0495-0.40774-0.061934-0.38919-0.28416 0.017644-0.20389 0.086447-0.5004-0.17305-0.50657-0.27801-0.0047368-0.81546 0.067974-1.5815 0.61778-0.75985 0.54981-1.0131 1.0378-1.0934 1.3035-0.08645 0.25946 0.22232 0.28416 0.42009 0.3336zm24.087 22.876-9.1924-12.843c-0.81546-1.1429-1.6433-1.4456-3.4842-2.4154-0.69191-0.36451-0.87724-0.67338-1.8842-1.7854-0.06193-0.067974-0.17912-0.05554-0.22232 0.03079-2.8603 5.4858-2.9097 5.1151-3.0271 5.8565-0.10516 0.66099-0.08029 1.2355 0.01764 1.8409 0.11747 0.74134 0.40772 1.4518 0.84634 2.0634l9.1986 12.843c0.46953 0.65483 1.2479 1.0008 2.0448 0.9081 2.4896-0.30268 4.8186-1.9769 5.912-4.2379 0.3336-0.73515 0.26564-1.6-0.20995-2.261z",fillColor:"#2ad2c5",fillOpacity:1,strokeWeight:.5,strokeColor:"#000000",size:new google.maps.Size(38,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(19,0)}:o.mapUseUrlIcon&&(m={url:o.mapUseUrlIcon});const s=new google.maps.Marker({position:p,map:t,title:r,icon:m});let d="";"yes"===n.map_show_infowindow_disclaimer&&(d=e("<div>").attr({class:"urwc-map-infowindow-disclaimer"}).append(e("<a>").attr({rel:"noopener noreferer nofollow",target:"_blank",href:"https://help.untappd.com/hc/en-us/articles/6166329931540-How-to-report-a-checkin-account-photo-or-comment"}).text(n.map_i18n[7])));const u=e("<div>").attr({class:"urwc-map-infowindow-pagination-container-"+o.mapUniqid}),g=e("<div>").attr({class:"urwc-map-infowindow-container-"+o.mapUniqid}),w=new google.maps.InfoWindow({content:e("<div>").append(g,u,d)[0].innerHTML,maxWidth:380,ariaLabel:r});var f;google.maps.event.addListener(w,"domready",(function(){c.length>1?e(".urwc-map-infowindow-pagination-container-"+o.mapUniqid).pagination({dataSource:c,pageSize:1,autoHidePrevious:!1,autoHideNext:!1,showPageNumbers:!1,showNavigator:!0,showGoButton:!1,showGoInput:!0,formatNavigator:"<%= currentPage %>/<%= totalPage %>",callback:function(n){e(".urwc-map-infowindow-container-"+o.mapUniqid).html(n[0].html)}}):e(".urwc-map-infowindow-container-"+o.mapUniqid).html(e(c[0].html))})),google.maps.event.addListener(s,"click",(f=s,function(){for(let e=0,n=a.length;e<n;e++)a[e].close();-1===a.indexOf(w)&&a.push(w),w.open(t,f)}))}function l(a){let t="";a.location&&(a.location="("+a.location+")",t=e("<a>").attr({rel:"noopener noreferer nofollow",target:"_blank",href:"https://www.google.com/maps/search/?api=1&query="+a.location}).text(a.location));let o="";a.rating_score&&(o=e("<div>").attr({class:"urwc-map-infowindow-checkin-rating"}).append(e("<h5>").text(n.map_i18n[2]+":")).append(e("<p>").html(e("<b>").text(a.rating_score+"/"+n.map_i18n[6]))));let i="";a.comment&&(i=e("<div>").attr({class:"urwc-map-infowindow-checkin-comment"}).append(e("<h5>").text(n.map_i18n[1]+":")).append(e("<p>").html(e("<b>").text(a.comment))));let p="";a.venue_name&&(p=a.foursquare_url&&"Untappd at Home"!==a.venue_name?e("<a>").attr({style:"text-decoration:underline",rel:"noopener noreferer nofollow",target:"_blank",href:a.foursquare_url}).text(a.venue_name):e("<b>").text(a.venue_name));let r="";a.permalink&&(r=e("<a>").attr({style:"display:block;width:100%;",target:"_blank",rel:"noopener noreferer nofollow",href:a.permalink}).text(n.map_i18n[5]),r=e("<div>").append(e("<p>").attr({class:"button product_type_simple add_to_cart_button ajax_add_to_cart urwc-map-infowindow-checkin-productlink"}).html(r)));const c=e("<div>").attr({class:"urwc-map-infowindow-checkin-title"}).append(e("<h5>").text(a.beer_name)),l=e("<div>").attr({class:"urwc-map-infowindow-checkin-img"}).append(e("<img>").attr({loading:"lazy",alt:a.beer_name,src:a.beer_label})),m=e("<div>").attr({class:"urwc-map-infoWindow-checkin-info"}).append(e("<b>").text(a.user_name+" ")).append(e("<b>").html((function(){return t}))).append(e("<span>").text(" "+n.map_i18n[3]+" ")).append(e("<span>").text(a.beer_name)).append(e("<span>").text(" "+n.map_i18n[4]+" ")).append(p).append(e("<span>").text(" "+n.map_i18n[0]+" "+a.checkin_date)).append(r).append(o).append(i);return e("<div>").attr({class:"urwc-map-infowindow-content"}).append(c).append(l).append(m)}return!!("object"!=typeof google||"object"!=typeof google.maps?(p("Google Maps Dynamic Library loader not present."),0):n.map_ajax_url?n.map_api_key?n.map_nonce?(o.mapApikey=n.map_api_key,o.mapLang=n.map_lang,o.mapAjaxurl=n.map_ajax_url,o.mapNonce=n.map_nonce,1):(p("Invalid security nonce, ajax calls will not load data."),0):(p("Google Javascript API key is required to initialize the map, check configuration."),0):(p("Endpoint URL is required to initialize the map, check configuration."),0))&&this.each((function(){r()}))}}(jQuery);